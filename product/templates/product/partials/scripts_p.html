<script type="text/javascript">

    <!-- Producto en favoritos --> 
    if('{{favorite}}' == 'True'){
        document.getElementById('Favorito_1').classList.remove('hidden');
        document.getElementById('Favorito_0').classList.add('hidden');
    }

    const descripcion = document.getElementById('desc');
    
    
    if(descripcion.clientHeight <= 200){
        leer_mas.classList.add('hidden');
    }

    function leer_mas_menos(){
        if(leer_mas.classList.contains("hidden")){
            leer_mas.classList.remove("hidden");
            leer_menos.classList.add("hidden");

            descripcion.classList.remove('full');
        }
        else{
            descripcion.classList.add('full');

            leer_mas.classList.add("hidden");
            leer_menos.classList.remove("hidden");
        }
    }

    const menu_tallas = document.querySelector('.menu-tallas-mobile');
    const menu_tallas_l = document.querySelector('.menu-tallas-mobile-l');

    function menu_tallas_mobile(){

        if (menu_tallas.classList.contains('invisible')){
            menu_tallas.classList.remove('invisible');
            menu_tallas.classList.add('visible');

            menu_tallas_l.style.animation ="tallas-open 500ms 1"

        }else{
            menu_tallas_l.style.animation ="tallas-close 500ms 1"
            
            menu_tallas.classList.remove('visible');
            menu_tallas.classList.add('invisible');
        }
   }

    const lens = document.getElementById('cursor_magnet')
    const product_img = document.getElementById('ImageCenter') 
    const magnified_img = document.getElementById('zooming')

    function magnify(product_img, magnified_img){
        product_img.addEventListener('mousemove', moveLens);
        lens.addEventListener('mousemove', moveLens);
        lens.addEventListener('mouseout', leaveLens);

    }
    
    function moveLens(e){
        ImgMarca.classList.add("hidden");
        information.classList.add("hidden");
        magnified_img.classList.remove("hidden");
        lens.classList.remove("hidden");
        //console.log('X: ' + e.pageX, 'Y:' + e.pageY)
        let x, y, cx, cy;
        //Position cursor
        const product_img_react = product_img.getBoundingClientRect();

        x = e.clientX - product_img_react.left - lens.offsetWidth/2;
        y = e.clientY - product_img_react.top - lens.offsetHeight/2;
        
        let max_xpos = product_img_react.width - lens.offsetWidth;
        let max_ypos = product_img_react.height - lens.offsetHeight;

        if(x >= max_xpos ) x = max_xpos;
        if(x <= 0) x = 0;
        
        if(y >= max_ypos) y = max_ypos;
        if(y <= 0) y = 0;

        lens.style.cssText = `top: ${y}px; left: ${x}px`

        //Zoom
        if(window.innerWidth >= 1280){
            cx = (magnified_img.offsetWidth / lens.offsetWidth) / 2.1;
            cy = (magnified_img.offsetHeight / lens.offsetHeight) / 2.5;
    
            magnified_img.style.cssText = `
                                background: url('${product_img.src}')
                                -${x * cx / 1.2}px -${y * cy / 1.7}px /
                                ${product_img_react.width * cx * 1.2}px ${product_img_react.height * cy}px
                                no-repeat
            `;

        }else{
            cx = (magnified_img.offsetWidth / lens.offsetWidth) / 2.2;
            cy = (magnified_img.offsetHeight / lens.offsetHeight) / 2.8;
    
            magnified_img.style.cssText = `
                                background: url('${product_img.src}')
                                -${x * cx / 1.0}px -${y * cy / 1.7}px /
                                ${product_img_react.width * cx * 1.4}px ${product_img_react.height * cy }px
                                no-repeat
            `;
        }
    }

    function leaveLens(){
        ImgMarca.classList.remove("hidden");
        information.classList.remove("hidden");
        magnified_img.classList.add("hidden");
        lens.classList.add("hidden");
    }
    
    magnify(product_img, magnified_img);


    const link = encodeURI(window.location.href);
    const msg = encodeURIComponent('Te recomiendo este producto de Esports Vivac: ')
    const title = encodeURIComponent(document.querySelector('title').textContent);

    const fb = document.getElementById('facebook');
    fb.href = `https://www.facebook.com/share.php?u=${link}`;
    
    const twitter = document.getElementById('twitter');
    twitter.href = `https://twitter.com/share?&url=${link}&text=${msg}&hashtags=sports`;

    try{
    
        const linkedIn = document.getElementById('linkedIn');
        linkedIn.href = `https://www.linkedin.com/sharing/share-offsite/?url=${link}&text=${msg}`;
    
        const reddit = document.getElementById('reddit');
        reddit.href = `https://www.reddit.com/submit?url=${link}&title=${title}`;
    }catch{}

    const whatsapp = document.getElementById('whatsapp');
    whatsapp.href = `https://api.whatsapp.com/send?text=${msg}${link}`;
    
    comp = document.getElementById('Compartir')
    const fav0 = document.getElementById('Favorito_0')
    const fav1 = document.getElementById('Favorito_1')
    const fav_no_user = document.getElementById('Favorito_no_user')

    function fav_add_remove(div1, str){
        if (str == 'add'){
            div1.classList.remove('w-[79%]');
            div1.classList.add('w-[100%]');
        }else{
            div1.classList.add('w-[79%]');
            div1.classList.remove('w-[100%]');
        }
    }

    comp.onclick = function(){
        comp.classList.add('hidden');
        Share.classList.remove('hidden');

        if(fav_no_user == null){
            fav_add_remove(fav0,'add');
            fav_add_remove(fav1,'add');
        }else{fav_add_remove(fav_no_user,'add');}
        

    }
    OutShare.onclick = function(){
        comp.classList.remove('hidden');
        Share.classList.add('hidden');

        if(fav_no_user == null){
            fav_add_remove(fav0,'remove');
            fav_add_remove(fav1,'remove');
        }else{fav_add_remove(fav_no_user,'remove');}
    }
    
    function NoTallas() {
        document.getElementById("noTallas").classList.remove("hidden");
    }
    //--------------------------------------------------------------------------------------





    //--------------------------------------------------------------------------------------

    
    function Image_mouseover(var_size) {
        document.getElementById("ImageCenter").src = var_size;
    }

    var final_size = ''
    var final_size_sp = ''

    function SelectSize(size, mobile=false) {
        size_sp = size.replace('/', '|')

        if (mobile) {
            menu_tallas_l.style.animation ="tallas-close 500ms 1"
            
            menu_tallas.classList.remove('visible');
            menu_tallas.classList.add('invisible');

        }
        EscogeTalla.value = size;

        document.getElementById("noTallas").classList.add("hidden");
        if(final_size != ''){
            document.getElementById('TallasId-'+ final_size ).classList.remove("border-black")
            document.getElementById('TallasId-'+ final_size + '-Mobile' ).classList.remove("border-black")
        }
        document.getElementById('TallasId-'+ size ).classList.add("border-black")
        document.getElementById('TallasId-'+ size + '-Mobile' ).classList.add("border-black")

        document.getElementById('añadir_carrito-'+ final_size_sp).classList.add("hidden")
        document.getElementById('añadir_carrito-'+ size_sp).classList.remove("hidden")

        final_size_sp = size_sp
        final_size = size

        precio_variant(final_size)
    }

    function disableScroll() {
    // Get the current page scroll position
    scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,

        // if any scroll is attempted, set this to the previous value
        window.onscroll = function() {
            window.scrollTo(scrollLeft, scrollTop);
        };
    }

    function enableScroll() {
        window.onscroll = function() {};
    }

    const FormReseña = document.getElementById('FormReseña');

    function FirstOp() {
        if (FormReseña){
            if(FormReseña.classList.contains('hidden')){
                    FormReseña.classList.remove('hidden');
                    disableScroll();
            }else{
                    FormReseña.classList.add('hidden');
                    enableScroll();
            }
        }else{
            menu_login_mobile(1);
        }
    }

    function OutForm() {
        el1.innerHTML = '';
        el2.innerHTML = '';
        el3.innerHTML = '';
        if(!FormReseña.classList.contains('hidden')){
                FormReseña.classList.add('hidden');
                enableScroll();
        }
    }


    const btn1 = document.getElementById("descripcion");
    const btn2 = document.getElementById("opiniones");
    const text1 = document.getElementById("div1");
    const text2 = document.getElementById("div2");

    const green1 = document.getElementById("descripcion_green")
    const green2 = document.getElementById("opiniones_green")

    function GoOpinions() {
        if(text2.classList.contains('hidden') && !text1.classList.contains('hidden')){
            text2.classList.remove('hidden');
            text1.classList.add('hidden');

            green1.classList.remove('w-[85px]', '-left-4');
            green1.classList.add('w-[185px]', 'left-[85px]');
        }

        if(window.innerWidth >= 1218){
            window.scroll({
                top: 700,
                behavior: "smooth",
            });
        }
    }


    btn1.onclick = function(){

        if(text1.classList.contains('hidden') && !text2.classList.contains('hidden')){
            text1.classList.remove('hidden');
            text2.classList.add('hidden');

            green1.classList.add('w-[85px]', '-left-4');
            green1.classList.remove('w-[185px]', 'left-[85px]');
            
            window.scroll({
            top: 700,
            behavior: "smooth",
            });
        }
    }

    btn2.onclick = function(){
        if(text2.classList.contains('hidden') && !text1.classList.contains('hidden')){
            text2.classList.remove('hidden');
            text1.classList.add('hidden');

            green1.classList.remove('w-[85px]', '-left-4');
            green1.classList.add('w-[185px]', 'left-[85px]');

            window.scroll({
            top: 700,
            behavior: "smooth",
            });
        }
    }

    const original_price = document.getElementById('original_price')
    const original_desc = document.getElementById('original_desc')

    function precio_variant(f_size){
        var list_size = document.getElementById('info_precios').value.replace('[[','').replace(']]','')
        var list_size = list_size.split('], [')
        for (i in list_size){
            list_size[i] = list_size[i].split(',')
        }

        if(!original_price.classList.contains('hidden')){
            original_price.classList.add('hidden')
            original_desc.classList.add('hidden')
        }

        for (i in list_size){
            var t = list_size[i][3].replace("'",'').replace("'",'').replace(" ",'')
            if(!document.getElementById(`precio_producto-${t}`).classList.contains('hidden')){
                document.getElementById(`precio_producto-${t}`).classList.add('hidden')
                document.getElementById(`precio_desc-${t}`).classList.add('hidden')
            }
        }
        for (i in list_size){
            var t = list_size[i][3].replace("'",'').replace("'",'').replace(" ",'')
            if(f_size == t){
                if(document.getElementById(`precio_producto-${t}`).classList.contains('hidden')){
                    document.getElementById(`precio_producto-${t}`).classList.remove('hidden')
                    document.getElementById(`precio_desc-${t}`).classList.remove('hidden')
                }
            }
        }
    }

</script>